<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: engine/rigid_shapes/rigid_rectangle_collision.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: engine/rigid_shapes/rigid_rectangle_collision.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* File: rigid_rectangle_collision.js
 *       Adds the collision functions for RigidRectangle class
 */
"use strict";

import CollisionInfo from "./collision_info.js";
import RigidRectangle from "./rigid_rectangle_main.js";

/**
 * default constructor
 * @ignore
 * @returns {SupportStruct}
 */
class SupportStruct {
    constructor() {
        this.mSupportPoint = null;
        this.mSupportPointDist = 0;
    }
}

// temp work area to conserve run time dynamic allocation cost
let mTmpSupport = new SupportStruct();
let mCollisionInfoR1 = new CollisionInfo();
let mCollisionInfoR2 = new CollisionInfo();

/**
 * Decides on which collision function to call based on the type of shape passed
 * @memberOf RigidRectangle 
 * @param {RigidShape} otherShape The other shape that's involved
 * @param {CollisionInfo} collisionInfo Where the collision information is stored
 * @returns {Boolean} The results of the collision
 */
RigidRectangle.prototype.collisionTest = function (otherShape, collisionInfo) {
    let status = false;
    if (otherShape.mType === "RigidCircle") {
        status = this.collideRectCirc(otherShape, collisionInfo);
    } else {
        status = this.collideRectRect(this, otherShape, collisionInfo);
    }
    return status;
}

/**
 * Finds the support point.
 * @param {type} dir
 * @param {type} ptOnEdge
 */
RigidRectangle.prototype.findSupportPoint = function (dir, ptOnEdge) {
    // the longest project length
    let vToEdge = [0, 0];
    let projection;

    mTmpSupport.mSupportPointDist = -Number.MAX_VALUE;
    mTmpSupport.mSupportPoint = null;
    // check each vector of other object
    for (let i = 0; i &lt; this.mVertex.length; i++) {
        vec2.subtract(vToEdge, this.mVertex[i], ptOnEdge);
        projection = vec2.dot(vToEdge, dir);
        
        // find the longest distance with certain edge
        // dir is -n direction, so the distance should be positive       
        if ((projection > 0) &amp;&amp; (projection > mTmpSupport.mSupportPointDist)) {
            mTmpSupport.mSupportPoint = this.mVertex[i];
            mTmpSupport.mSupportPointDist = projection;
        }
    }
}

/**
 * /**
 * Find the shortest axis that overlapping
 * @memberOf RigidRectangle
 * @param {RigidRectangle} otherRect  Another rectangle that being tested
 * @param {CollisionInfo} collisionInfo  Record the collision information
 * @returns {Boolean} True if has overlap part in all four directions.
 * this code is referenced and adapted from 
 * http://gamedevelopment.tutsplus.com/tutorials/how-to-create-a-custom-2d-physics-engine-oriented-rigid-bodies--gamedev-8032
 */
RigidRectangle.prototype.findAxisLeastPenetration = function (otherRect, collisionInfo) {
    let n;
    let supportPoint;

    let bestDistance = Number.MAX_VALUE;
    let bestIndex = null;

    let hasSupport = true;
    let i = 0;

    let dir = [0, 0];
    while ((hasSupport) &amp;&amp; (i &lt; this.mFaceNormal.length)) {
        // Retrieve a face normal from A
        n = this.mFaceNormal[i];

        // use -n as direction and the vertex on edge i as point on edge    
        vec2.scale(dir, n, -1);
        let ptOnEdge = this.mVertex[i];
        // find the support on B
        // the point has longest distance with edge i 
        otherRect.findSupportPoint(dir, ptOnEdge);
        hasSupport = (mTmpSupport.mSupportPoint !== null);
        
        // get the shortest support point depth
        if ((hasSupport) &amp;&amp; (mTmpSupport.mSupportPointDist &lt; bestDistance)) {
            bestDistance = mTmpSupport.mSupportPointDist;
            bestIndex = i;
            supportPoint = mTmpSupport.mSupportPoint;
        }
        i = i + 1;
    }
    if (hasSupport) {
        // all four directions have support point
        let bestVec = [0, 0];
        vec2.scale(bestVec, this.mFaceNormal[bestIndex], bestDistance);
        let atPos = [0, 0];
        vec2.add(atPos, supportPoint, bestVec);
        collisionInfo.setInfo(bestDistance, this.mFaceNormal[bestIndex], atPos);
    }
    return hasSupport;
}
    
/**
 * Check for collision between RigidRectangle and RigidRectangle
 * @param {RigidRectangle} r1 RigidRectangle object to check for collision status
 * @param {RigidRectangle} r2 RigidRectangle object to check for collision status against
 * @param {CollisionInfo} collisionInfo Collision info of collision
 * @returns {Boolean} true if collision occurs
 * @memberOf RigidRectangle
 */   
RigidRectangle.prototype.collideRectRect = function (r1, r2, collisionInfo) {
    let status1 = false;
    let status2 = false;

    // find Axis of Separation for both rectangle
    status1 = r1.findAxisLeastPenetration(r2, mCollisionInfoR1);

    if (status1) {
        status2 = r2.findAxisLeastPenetration(r1, mCollisionInfoR2);
        if (status2) {
            let depthVec = [0, 0];
            // if both of rectangles are overlapping, choose the shorter normal as the normal       
            if (mCollisionInfoR1.getDepth() &lt; mCollisionInfoR2.getDepth()) {
                vec2.scale(depthVec, mCollisionInfoR1.getNormal(), mCollisionInfoR1.getDepth());
                let pos = [0, 0];
                vec2.subtract(pos, mCollisionInfoR1.mStart, depthVec);
                collisionInfo.setInfo(mCollisionInfoR1.getDepth(), mCollisionInfoR1.getNormal(), pos);
            } else {
                vec2.scale(depthVec, mCollisionInfoR2.getNormal(), -1);
                collisionInfo.setInfo(mCollisionInfoR2.getDepth(), depthVec, mCollisionInfoR2.mStart);
            }
        } 
    }
    return status1 &amp;&amp; status2;
}

export default RigidRectangle;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BurstEmitter.html">BurstEmitter</a></li><li><a href="Color.html">Color</a></li><li><a href="DustEmitter.html">DustEmitter</a></li><li><a href="DustParticle.html">DustParticle</a></li><li><a href="ElectricityEmitter.html">ElectricityEmitter</a></li><li><a href="ElectricParticle.html">ElectricParticle</a></li><li><a href="FlameEmitter.html">FlameEmitter</a></li><li><a href="FlameParticle.html">FlameParticle</a></li><li><a href="glMatrix.html">glMatrix</a></li><li><a href="mat2.html">mat2</a></li><li><a href="mat2d.html">mat2d</a></li><li><a href="mat3.html">mat3</a></li><li><a href="mat4.html">mat4</a></li><li><a href="Particle.html">Particle</a></li><li><a href="ParticleEmitter.html">ParticleEmitter</a></li><li><a href="ParticleSet.html">ParticleSet</a></li><li><a href="PixelRenderable.html">PixelRenderable</a></li><li><a href="PointShader.html">PointShader</a></li><li><a href="quat.html">quat</a></li><li><a href="RainEmitter.html">RainEmitter</a></li><li><a href="RainParticle.html">RainParticle</a></li><li><a href="SnowEmitter.html">SnowEmitter</a></li><li><a href="SnowParticle.html">SnowParticle</a></li><li><a href="vec2.html">vec2</a></li><li><a href="vec3.html">vec3</a></li><li><a href="vec4.html">vec4</a></li></ul><h3>Global</h3><ul><li><a href="global.html#activate()-Activatestheshaderforrendering">activate() - Activates the shader for rendering</a></li><li><a href="global.html#addBurstAt()-Addsanewburstemitteratthegivenposition">addBurstAt() - Adds a new burst emitter at the given position</a></li><li><a href="global.html#addDust()-Createsanewdustemitter">addDust() - Creates a new dust emitter</a></li><li><a href="global.html#addElectricityAt()-Addsanewelectricemitteratthegivenposition">addElectricityAt() - Adds a new electric emitter at the given position</a></li><li><a href="global.html#addEmitterAt()-Addsadefaultemittertothegivenposition">addEmitterAt() - Adds a default emitter to the given position</a></li><li><a href="global.html#addFlameAt()-Addsanewflameemittertothegivenposition">addFlameAt() - Adds a new flame emitter to the given position</a></li><li><a href="global.html#addRain()-Createsanewrainemitter">addRain() - Creates a new rain emitter</a></li><li><a href="global.html#addSnow()-Createsanewsnowemitter">addSnow() - Creates a new snow emitter</a></li><li><a href="global.html#createBurst()-Creatorfunctionusedbytheemitter,createsaparticleandreturnsit.Usedforbursteffects.">createBurst() - Creator function used by the emitter, creates a particle and returns it.                           Used for burst effects.</a></li><li><a href="global.html#createBurst()-Creatorfunctionusedbytheemitter,createsaparticleandreturnsit.Usedforelectricityeffects.">createBurst() - Creator function used by the emitter, creates a particle and returns it.                           Used for electricity effects.</a></li><li><a href="global.html#createDust()-Createsdustparticles">createDust() - Creates dust particles</a></li><li><a href="global.html#createRain()-Createsrainparticles">createRain() - Creates rain particles</a></li><li><a href="global.html#createSnow()-Createssnowparticles">createSnow() - Creates snow particles</a></li><li><a href="global.html#draw()-Activatestheshaderoftherenderableanddrawstothegivencamera">draw() - Activates the shader of the renderable and draws to the given camera</a></li><li><a href="global.html#draw()-Drawstheparticletothegivencamera">draw() - Draws the particle to the given camera</a></li><li><a href="global.html#draw()-Drawstothegivencamera.">draw() - Draws to the given camera.</a></li><li><a href="global.html#emitParticles()-Createsandemitsparticlesbasedonthecreatorfunction">emitParticles() - Creates and emits particles based on the creator function</a></li><li><a href="global.html#emitParticles()-Createstheparticlestobeemittedandpushesthemtotheparticleset">emitParticles() - Creates the particles to be emitted and pushes them to the particle set</a></li><li><a href="global.html#emitParticles()-usesthecreatorfunctiontocreateandemitparticles">emitParticles() - uses the creator function to create and emit particles</a></li><li><a href="global.html#expired()-Checksifthenumberofparticlesremainingislessthanorequalto0">expired() - Checks if the number of particles remaining is less than or equal to 0</a></li><li><a href="global.html#getAcceleration()-getsthecurrentacceleration">getAcceleration() - gets the current acceleration</a></li><li><a href="global.html#getAcceleration()-Getsthecurrentacceleration">getAcceleration() - Gets the current acceleration</a></li><li><a href="global.html#getClimb()-getsthecurrentverticalacceleration">getClimb() - gets the current vertical acceleration</a></li><li><a href="global.html#getColor()-Getsthecurrentcolor">getColor() - Gets the current color</a></li><li><a href="global.html#getColorEnd()-Getstheendingcolor">getColorEnd() - Gets the ending color</a></li><li><a href="global.html#getColorStart()-getsthestartingcolor">getColorStart() - gets the starting color</a></li><li><a href="global.html#getDrag()-getsthecurrentdrag">getDrag() - gets the current drag</a></li><li><a href="global.html#getDrag()-Getsthecurrentdrag">getDrag() - Gets the current drag</a></li><li><a href="global.html#getDrawBounds()-Returnsthedrawingboundsoftheparticle">getDrawBounds() - Returns the drawing bounds of the particle</a></li><li><a href="global.html#getGrowth()-Getsthecurrentgrowthrate">getGrowth() - Gets the current growth rate</a></li><li><a href="global.html#getIntensity()-getsthenumberofremainingparticles">getIntensity() - gets the number of remaining particles</a></li><li><a href="global.html#getNumParticles()-getsthecurrentnumberofparticlestobeemitted">getNumParticles() - gets the current number of particles to be emitted</a></li><li><a href="global.html#getParticleSize()-Returnsthesizeoftheparticles">getParticleSize() - Returns the size of the particles</a></li><li><a href="global.html#getPosition()-Getsthecurrentpositionoftheparticle">getPosition() - Gets the current position of the particle</a></li><li><a href="global.html#getPosition()-Getsthecurrentpositionoftherenderable">getPosition() - Gets the current position of the renderable</a></li><li><a href="global.html#getPulses()-getsthenumberofpulsesfortheburst">getPulses() - gets the number of pulses for the burst</a></li><li><a href="global.html#getPulses()-getsthenumberofpulsesfortheelectricity">getPulses() - gets the number of pulses for the electricity</a></li><li><a href="global.html#getRadius()-Returnsthecurrentradius">getRadius() - Returns the current radius</a></li><li><a href="global.html#getSize()-Getsthecurrentpointsize">getSize() - Gets the current point size</a></li><li><a href="global.html#getSize()-getsthesizeoftheparticle">getSize() - gets the size of the particle</a></li><li><a href="global.html#getSizeVariance()-getsthecurrentsizevariance">getSizeVariance() - gets the current size variance</a></li><li><a href="global.html#getSpacing()-getsthespacing">getSpacing() - gets the spacing</a></li><li><a href="global.html#getSpread()-Getsthespreadoftheelectricity">getSpread() - Gets the spread of the electricity</a></li><li><a href="global.html#getSpread()-Getsthespreadoftheflame">getSpread() - Gets the spread of the flame</a></li><li><a href="global.html#getSpread()-Getsthespreadoftheparticles">getSpread() - Gets the spread of the particles</a></li><li><a href="global.html#getVelocity()-getsthecurrentvelocity">getVelocity() - gets the current velocity</a></li><li><a href="global.html#getWind()-Getsthecurrenthorizontalacceleration">getWind() - Gets the current horizontal acceleration</a></li><li><a href="global.html#getWind()-Returnsthecurrenthorizontalacceleration">getWind() - Returns the current horizontal acceleration</a></li><li><a href="global.html#hasExpired()-Checksiftheparticlehasexpiredornot">hasExpired() - Checks if the particle has expired or not</a></li><li><a href="global.html#hit()-Behavioroftheparticleuponcollision">hit() - Behavior of the particle upon collision</a></li><li><a href="global.html#setAcceleration()-Setsthecurrentacceleration">setAcceleration() - Sets the current acceleration</a></li><li><a href="global.html#setAcceleration()-updatesthecurrentacceleration">setAcceleration() - updates the current acceleration</a></li><li><a href="global.html#setClimb()-setstheverticalacceleration">setClimb() - sets the vertical acceleration</a></li><li><a href="global.html#setColor()-Setsthecurrentcolortoanewone">setColor() - Sets the current color to a new one</a></li><li><a href="global.html#setColorEnd()-Setstheendingcolor">setColorEnd() - Sets the ending color</a></li><li><a href="global.html#setColorStart()-Setsthestartingcolor">setColorStart() - Sets the starting color</a></li><li><a href="global.html#setDrag()-Setsthecurrentdragtoanewvalue">setDrag() - Sets the current drag to a new value</a></li><li><a href="global.html#setDrag()-setsthedragforeachparticlebeingemitted">setDrag() - sets the drag for each particle being emitted</a></li><li><a href="global.html#setDrawBounds()-Setsthedrawingbounds">setDrawBounds() - Sets the drawing bounds</a></li><li><a href="global.html#setFinalColor()-Setsthefinalcoloroftheparticle">setFinalColor() - Sets the final color of the particle</a></li><li><a href="global.html#setGrowth()-Setsthegrowthratetoanewvalue">setGrowth() - Sets the growth rate to a new value</a></li><li><a href="global.html#setIntensity()-Setsthenumberofremainingparticles">setIntensity() - Sets the number of remaining particles</a></li><li><a href="global.html#setNumParticles()-Setsthenumberofparticlestoemittoanewvalue">setNumParticles() - Sets the number of particles to emit to a new value</a></li><li><a href="global.html#setParticleSize()-Setsthesizeoftheparticles">setParticleSize() - Sets the size of the particles</a></li><li><a href="global.html#setPointSize()-setsthepixelsizetoallowresizing">setPointSize() - sets the pixel size to allow resizing</a></li><li><a href="global.html#setPosition()-Setsthepositionoftheparticle">setPosition() - Sets the position of the particle</a></li><li><a href="global.html#setPosition()-Setsthepositionoftherenderable">setPosition() - Sets the position of the renderable</a></li><li><a href="global.html#setPulses(pulses)-Setsthenumberofpulses">setPulses(pulses) - Sets the number of pulses</a></li><li><a href="global.html#setRadius()-Setstheradiustoanewvalue">setRadius() - Sets the radius to a new value</a></li><li><a href="global.html#setShowPoint()-Setswhetherornotthepixelgetsdrawn">setShowPoint() - Sets whether or not the pixel gets drawn</a></li><li><a href="global.html#setSize()-Setsthesizeoftheparticle">setSize() - Sets the size of the particle</a></li><li><a href="global.html#setSize()-Setsthesizeofthepoint">setSize() - Sets the size of the point</a></li><li><a href="global.html#setSizeDelta()-Setsthesizedelta">setSizeDelta() - Sets the size delta</a></li><li><a href="global.html#setSizeVariance()-Setsthesizevariance">setSizeVariance() - Sets the size variance</a></li><li><a href="global.html#setSpacing()-setsthespacebetweeneachringintheburst">setSpacing() - sets the space between each ring in the burst</a></li><li><a href="global.html#setSpread()-Setsthecurrentparticlespreadtoanewvalue">setSpread() - Sets the current particle spread to a new value</a></li><li><a href="global.html#setSpread()-Setsthespreadoftheelectricity">setSpread() - Sets the spread of the electricity</a></li><li><a href="global.html#setSpread()-Setsthespreadoftheflame">setSpread() - Sets the spread of the flame</a></li><li><a href="global.html#setVelocity()-Setsthecurrentvelocity">setVelocity() - Sets the current velocity</a></li><li><a href="global.html#setWind()-Setsthehorizontalacceleration">setWind() - Sets the horizontal acceleration</a></li><li><a href="global.html#terminate()-setsnumRemainsto0">terminate() - sets numRemains to 0</a></li><li><a href="global.html#terminate()-Setsthenumberofcyclesto0">terminate() - Sets the number of cycles to 0</a></li><li><a href="global.html#update()-Cleansupandemitsparticlesintheset">update() - Cleans up and emits particles in the set</a></li><li><a href="global.html#update()-Updatestheparticle'sposition">update() - Updates the particle's position</a></li><li><a href="global.html#update()-Usesthepositionandcolorcontrolvariablestoupdatetheparticlebasedontheupdateinterval">update() - Uses the position and color control variables to update the particle based on the update interval</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Mon Mar 14 2022 13:56:22 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
